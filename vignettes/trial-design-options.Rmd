---
title: "Trial Design Options"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{trial-design-options}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


Load the `ofpetrial` package.

```{r setup}
library(ofpetrial)
```

Let's first  prepare experiment plots to which we assign rates using various trial design options.

```{r}
n_plot_info <-
  make_input_plot_data(
    form = "NH3",
    plot_width = measurements::conv_unit(30, "ft", "m"),
    machine_width = measurements::conv_unit(30, "ft", "m"),
    section_num = 1
  )

exp_data <-
  make_exp_plots(
    input_plot_info = n_plot_info,
    boundary_file = system.file("extdata", "boundary-simple1.shp", package = "ofpetrial"),
    abline_file = system.file("extdata", "ab-line-simple1.shp", package = "ofpetrial"),
    harvester_width = 30,
    abline_type = "free",
    headland_length = 30,
    side_length = 60,
    min_plot_length = 240,
    max_plot_length = 260,
    length_unit = "feet",
    perpendicular = FALSE
  )

viz_ep(exp_data, abline = FALSE)
```

# Latin Square ("ls")

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 140, 180, 220, 260),
    design_type = "ls",
    rank_seq_ws = c(1, 2, 3, 4, 5),
    rank_seq_as = c(1, 2, 3, 4, 5)
  )

td_ls_1 <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_ls_1, abline = FALSE)
```

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 140, 180, 220, 260),
    design_type = "ls",
    rank_seq_ws = c(5, 2, 4, 1, 3),
    rank_seq_as = c(1, 5, 2, 4, 3)
  )

td_ls_2 <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_ls_2, abline = FALSE)
```

# Strip trial ("strip")

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 160, 220, 280),
    rank_seq_as = c(1, 4, 3, 2),
    design_type = "strip",
  )

td_strip <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_strip, abline = FALSE)
```

# Randomized Block ("rb")

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 140, 180, 220, 260),
    design_type = "rb",
  )

td_rb <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_rb, abline = FALSE)
```

# Jump-conscious Latin Square ("jcls")

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 140, 180, 220, 260),
    design_type = "jcls",
  )

td_jcls <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_jcls, abline = FALSE)
```

# Extra Jump-conscious Alternate ("ejca")

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 140, 180, 220, 260, 300),
    design_type = "ejca",
  )

td_ejca <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_ejca, abline = FALSE)
```

# Sparse ("sparse")

```{r}
n_rate_info <-
  make_input_rate_data(
    plot_info = n_plot_info,
    gc_rate = 180,
    unit = "lb",
    rates = c(100, 140, 180, 220, 260, 300),
    design_type = "sparse",
  )

td_sparse <-
  assign_rates(
    exp_data = exp_data,
    rate_info = n_rate_info
  )
```

```{r}
viz_td(td_sparse, abline = FALSE)
```

